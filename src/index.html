<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy" content="frame-ancestors 'self' http://localhost:8180" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta name="theme-color" content="#000000" />
  <link rel="manifest" href="./manifest.json" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="<%= htmlWebpackPlugin.options.gameName %>" />
  <meta name="apple-mobile-web-app-title" content="<%= htmlWebpackPlugin.options.gameName %>" />
  <meta name="msapplication-starturl" content="./" />
  <link rel="icon" type="image/png" sizes="192x192" href="./icons/icons-192.png" />
  <link rel="apple-touch-icon" type="image/png" sizes="192x192" href="./icons/icons-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="./icons/icons-512.png" />
  <link rel="apple-touch-icon" type="image/png" sizes="512x512" href="./icons/icons-512.png" />
  <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon" />
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="http://localhost:8180/js/keycloak.js"></script>
  <title><%= htmlWebpackPlugin.options.gameName %></title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background-color: #000000;
    }
    canvas {
      display: block;
      cursor: url('assets/gui/pointer05.png'), auto;
    }
  </style>
  <noscript>Please enable javascript to continue using this application.</noscript>
</head>
<body>
  <div id="phaser-game"></div>
  <div id="username"></div>

  <script>
    var keycloak;

    window.onload = function() {
      keycloak = new Keycloak({
        realm: "usager",
        "auth-server-url": "http://localhost:8180/auth/",
        "ssl-required": "external",
        clientId: "frontend",
        "public-client": true,
        "confidential-port": 0
      });

      keycloak.init({ onLoad: 'login-required' })
        .then(function(authenticated) {
          if (authenticated) {
            console.log('Authenticated');
            keycloak.loadUserProfile().then(function(profile) {
              alert('Authenticated as ' + profile.username);
              startGame(profile.username); // Pass the username to the game start function
            }).catch(function() {
              alert('Failed to load user profile');
            });
          } else {
            console.log('Not authenticated');
            keycloak.login(); // Redirects to Keycloak login page
          }
        })
        .catch(function(error) {
          console.error('Failed to initialize Keycloak', error);
          alert('Failed to initialize Keycloak');
        });
    }

    function startGame(username) {
      // Your game initialization logic goes here
      console.log('Game starting for user: ' + username);
      // Display the username in the game or UI
      document.getElementById('username').innerText = 'Welcome, ' + username;
    }
  </script>
</body>
</html>
